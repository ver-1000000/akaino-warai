"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},__read=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},__spread=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},random=function(t){return void 0===t&&(t=100),Math.round(Math.random()*t)},average=function(t){return t.reduce((function(t,e){return t+e}),0)/t.length},median=function(t){var e=t.length/2|0,n=t.slice().sort((function(t,e){return t<e?-1:e<t?1:0}));return n.length%2?n[e]:(n[e-1]+n[e])/2},now=function(){return(new Date).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"numeric"}).replace(/\D/g,"")},QUERY_NAME_MAP={".body":"身体―― Body",".nose":"鼻―― Nose",".fang .left":"左のキバ―― Left Fang",".fang .right":"右のキバ―― Right Fang",".eye .left":"左目―― Left Eye",".eye .right":"右目―― Right Eye"};function assertIsDefined(t){if(null==t)throw alert("レンダリングエラー: ページを再読込してください。"),new Error("Expected 'val' to be defined, but received "+t)}var Entity=function(){function t(t){this.animation=!1,this.uniqQuery=t,this.name=t in QUERY_NAME_MAP?QUERY_NAME_MAP[t]:"";var e=document.querySelector(t);assertIsDefined(e),this.element=e}return Object.defineProperty(t.prototype,"searchParams",{get:function(){var e=this,n=new URLSearchParams;return t.RESTORABLE_ATTRIBUTES.map((function(t){return[t,e.element.style.getPropertyValue(t)]})).forEach((function(t){var r=__read(t,2),o=r[0],i=r[1];return i&&n.append(e.uniqQuery+":"+o,i)})),n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){var t=function(t){return(t||"").split(/[^0-9^\\.]/).filter(Boolean).map(Number)},e=__read(t(this.element.style.getPropertyValue("transform")),4),n=e[0],r=e[1],o=e[2],i=e[3],a=__read(t(this.element.style.getPropertyValue("transform-origin")),2);return{x:n,y:r,scale:o,rotate:i,originX:a[0],originY:a[1]}},enumerable:!1,configurable:!0}),t.prototype.removeClass=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=this.element.classList).remove.apply(t,__spread(e))},t.prototype.addClass=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=this.element.classList).add.apply(t,__spread(e))},t.prototype.updateStyle=function(t,e){this.element.style.setProperty(t,e)},t.prototype.reset=function(){this.updateStyle("transform","translate(0px, 0px) scale(1) rotate(0deg)"),this.updateStyle("transform-origin","50px 40px")},t.prototype.restore=function(){var e=this,n=Object.fromEntries(new URLSearchParams(location.search));t.RESTORABLE_ATTRIBUTES.forEach((function(t){var r=n[e.uniqQuery+":"+t];r&&e.updateStyle(t,r),location.search.includes("%2C")||e.element.setAttribute(t,r)}))},t.RESTORABLE_ATTRIBUTES=["stroke","transform","transform-origin"],t}(),Service=function(){function t(){this.hue=random(),this.world=new Entity(".world"),this.topText=new Entity(".top .text"),this.buttons=new Entity(".buttons"),this.saveImageButton=new Entity(".bottom .left.button"),this.tweetButton=new Entity(".bottom .center.button"),this.resetButton=new Entity(".bottom .right.button"),this.animEntities=Object.keys(QUERY_NAME_MAP).map((function(t){return new Entity(t)})),this.params=new URLSearchParams(location.href),new Control(this),null!=this.params.get("hue")&&this.restore(),null!=this.params.get("download")&&this.downloadImage()}return Object.defineProperty(t.prototype,"bgColor",{get:function(){return"hsl("+this.hue+", 100%, 70%)"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"accentColor",{get:function(){return"hsl("+(this.hue-90)%360+", 100%, 40%)"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resultURL",{get:function(){var t=new URLSearchParams;return this.animEntities.forEach((function(e){return __spread(e.searchParams).forEach((function(e){var n=__read(e,2),r=n[0],o=n[1];return t.append(r,o)}))})),t.append("hue",String(this.hue)),location.href.replace(/(?!.*\/).*/,"")+"?"+t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){var t=this.animEntities.reduce((function(t,e){var n=e.value;return{x:__spread(t.x,[n.x]),y:__spread(t.y,[n.y]),scale:__spread(t.scale,[n.scale]),rotate:__spread(t.rotate,[n.rotate]),originX:__spread(t.originX,[n.originX])}}),{x:[],y:[],scale:[],rotate:[],originX:[]}),e=function(t,e,n,r){void 0===r&&(r=!1);return average(t.map((function(o){return function(t,e,n,r,o){void 0===o&&(o=!1);var i=e-t;return 100-Math.abs(n-r%e*(o?2:1))/i*100}(e,n,median(t),o,r)})))},n=[e(t.x,-64,64),e(t.y,-64,64),e(t.scale,.5,5.5),e(t.rotate,0,180,!0),e(t.originX,45,55)];return Math.round(10*average(n))/10},enumerable:!1,configurable:!0}),t.prototype.downloadImage=function(){this.restore(),this.buttons.addClass("hidden"),svg2png(this.world.element).then((function(t){Object.assign(document.createElement("a"),{href:t,download:"akaino-warai_"+now()+".png"}).click(),close()}))},t.prototype.openDownloadWindow=function(){open(this.resultURL+"&download=")},t.prototype.tweet=function(){var t=encodeURIComponent(this.resultURL),e=this.score,n=encodeURIComponent(e+"点！ "+(e<6?"キミは伝説の低級戦士……":e<30?"もうなんだかよくわからない！":e<50?"こんな朱猪になっちゃった！":e<70?"まあまあの出来！":e<90?"イイ線いってる！":e<95?"ミラクルショット！あと一歩！":"こんな完璧な朱猪ってある？？？")+" 朱猪わらいで朱猪を完成させよう！"),r=encodeURIComponent("朱猪わらい");open("//twitter.com/intent/tweet?text="+n+"&url="+t+"&hashtags="+r,"_blank","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width=710,height=400")},t.prototype.reset=function(){this.hue=random(360),this.animEntities.forEach((function(t){return t.reset()})),new Control(this)},t.prototype.restore=function(){this.hue=Number(this.params.get("hue")),this.animEntities.forEach((function(t){return t.restore()})),this.world.element.style.setProperty("background-color",this.bgColor),this.topText.updateStyle("stroke",this.accentColor),this.finish(),this.updateTopText()},t.prototype.finish=function(){var t=this;this.world.element.onclick=this.world.element.onkeyup=null,this.world.addClass("loading"),setTimeout((function(){t.buttons.removeClass("hidden"),t.updateTopText("Score: "+t.score)}),500)},t.prototype.updateTopText=function(t){void 0===t&&(t=""),this.topText.element.innerHTML=t},t}(),Control=function(){function t(t){this.service=t,this.currentEntity=null,this.service=t,this.start()}return t.prototype.saveImageButtonClick=function(t){t.stopPropagation(),this.service.openDownloadWindow()},t.prototype.tweetButtonClick=function(t){t.stopPropagation(),this.service.tweet()},t.prototype.resetButtonClick=function(t){t.stopPropagation(),this.service.reset()},t.prototype.nextStep=function(){var t=this;null==this.currentEntity?(this.service.animEntities.forEach((function(e){return t.animate(e)})),this.currentEntity=this.service.animEntities[0]):(this.currentEntity.updateStyle("stroke",null),this.currentEntity.animation=!1,this.currentEntity=this.service.animEntities[this.service.animEntities.indexOf(this.currentEntity)+1]),this.currentEntity?(this.service.updateTopText(this.currentEntity.name),this.currentEntity.updateStyle("stroke",this.service.accentColor)):this.service.finish()},t.prototype.start=function(){var t=this;this.service.world.element.focus(),this.service.world.removeClass("loading"),this.service.updateTopText("クリックすると始まるよ！―― Click to Start!"),this.service.world.element.style.setProperty("background-color",this.service.bgColor),this.service.topText.updateStyle("stroke",this.service.accentColor),this.service.buttons.addClass("hidden"),this.service.saveImageButton.element.onclick=function(e){return t.saveImageButtonClick(e)},this.service.tweetButton.element.onclick=function(e){return t.tweetButtonClick(e)},this.service.resetButton.element.onclick=function(e){return t.resetButtonClick(e)},this.service.world.element.onclick=function(){return t.nextStep()},this.service.world.element.onkeyup=function(){return t.nextStep()}},t.prototype.animate=function(t){var e=function(n){var r=n.origin,o=n.x,i=n.y,a=n.scale,s=n.rotate,u=50+Math.abs(r-5),c=(5+Math.abs(a-50))/10,l=64-Math.abs(128-o),h=64-Math.abs(128-i);t.updateStyle("transform","translate("+l+"px, "+h+"px) scale("+c+") rotate("+s+"deg)"),t.updateStyle("transform-origin",u+"px 40px"),r=(r+1)%10,o=(o+7)%256,i=(i+3)%256,a=(a+1)%100,s=(s+9)%360,t.animation&&requestAnimationFrame((function(){return e({origin:r,x:o,y:i,scale:a,rotate:s})}))};t.animation=!0,e({origin:random(10),x:random(256),y:random(256),scale:random(100),rotate:random(360)})},t}();addEventListener("load",(function(t){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(t){return[2,new Service]}))}))}));var svg2png=function(t){for(var e,n,r,o,i=t.cloneNode(!1),a=[[t,i]];0!==a.length;){var s=__read(a.pop()||[],2),u=s[0],c=s[1],l=window.getComputedStyle(u,""),h=u.children;try{for(var p=(e=void 0,__values(l)),d=p.next();!d.done;d=p.next()){var f=d.value;c.style[f]=l.getPropertyValue(f)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}if(0!==h.length)try{for(var y=(r=void 0,__values(h)),m=y.next();!m.done;m=y.next()){var v=m.value,g=v.cloneNode(!1);c.appendChild(g),a.push([v,g])}}catch(t){r={error:t}}finally{try{m&&!m.done&&(o=y.return)&&o.call(y)}finally{if(r)throw r.error}}else c.innerHTML=u.innerHTML}var b=(new XMLSerializer).serializeToString(i),w={width:t.width.baseVal.value,height:t.height.baseVal.value},_=Object.assign(document.createElement("canvas"),w),E=_.getContext("2d"),x=new Image;return new Promise((function(t,e){x.onload=function(){null==E||E.drawImage(x,0,0),t(_.toDataURL("image/png"))},x.onerror=function(t){return e(t)},x.src="data:image/svg+xml;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(b)))}))};